#include  "uvebase.inc"
#include  "repair.inc"
import    "xlm.exp"

name      "Malware-fortest-1.2.0"
record    3
dtype     MCS_DTYPE_UNKNOWN, MCS_DTYPE_EMAIL
virustype MCS_VTYPE_MALWARE
sclass    TCS_SC_TERMINAL
blevel    TCS_BC_LEVEL2

    
    lqmatch MATCH_PATTERN, 0, (d0h, cfh, 11h, e0h, a1h, b1h, 1ah, e1h)

MATCH_PATTERN:
    mov 175ch, DP
    mov 42, r0
    lea PATTERN, r1
    lea WILDCARD, r2
    SET_ZERO(r3)
    mov r0, r4
    
    qsearchi r1, r0, r2, r3, r4
    test FL, UVE_FL_VIRUSFOUND
    JZ Quit
    
    
    mov 17a6h, DP
    mov 42, r0
    lea VARIANT, r1
    lea WILDCARD, r2
    SET_ZERO(r3)
    mov r0, r4
    
    and FL, ~UVE_FL_VIRUSFOUND, FL
    qsearchi r1, r0, r2, r3, r4
    setvariant "Variant-fortest-1.2.0"
    
CheckVirusFound:
    test FL, UVE_FL_VIRUSFOUND
    JZ Quit
    CheckRepairFlag(Clean)
Quit:
    exit
Clean:
    calli CleanScannedFile
    exit

PATTERN:
bdata (4dh, 00h, 61h, 00h, 6ch, 00h, 77h, 00h, 61h, 00h, 72h, 00h, 65h, 00h, 2dh, 00h, 66h, 00h, 6fh, 00h, 72h, 00h, 74h, 00h, 65h, 00h, 73h, 00h, 74h, 00h, 2dh, 00h, 31h, 00h, 2eh, 00h, 32h, 00h, 2eh, 00h, 30h, 00h)

VARIANT:
bdata (56h, 00h, 61h, 00h, 72h, 00h, 69h, 00h, 61h, 00h, 6eh, 00h, 74h, 00h, 2dh, 00h, 66h, 00h, 6fh, 00h, 72h, 00h, 74h, 00h, 65h, 00h, 73h, 00h, 74h, 00h, 2dh, 00h, 31h, 00h, 2eh, 00h, 32h, 00h, 2eh, 00h, 30h, 00h)

WILDCARD:
bdata ("*?")
