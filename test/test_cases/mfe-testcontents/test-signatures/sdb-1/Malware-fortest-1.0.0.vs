#include  "uvebase.inc"
#include  "repair.inc"
import    "xlm.exp"

name      "Malware-fortest-1.0.0"
record    4
dtype     MCS_DTYPE_UNKNOWN, MCS_DTYPE_HTML
virustype MCS_VTYPE_MALWARE
sclass    TCS_SC_USER
blevel    TCS_BC_LEVEL0

    
    lqmatch MATCH_PATTERN, 0, ("<!DOCTYPE html PUBLIC")

MATCH_PATTERN:
    mov 13fh, DP
    lea PATTERN, r0
    swi UVE_SWI_STRLEN
    lea PATTERN, r1
    lea WILDCARD, r2
    SET_ZERO(r3)
    mov r0, r4
    
    qsearchi r1, r0, r2, r3, r4
    test FL, UVE_FL_VIRUSFOUND
    JZ Quit
    
    
    mov 172h, DP
    lea VARIANT, r0
    swi UVE_SWI_STRLEN
    lea VARIANT, r1
    lea WILDCARD, r2
    SET_ZERO(r3)
    mov r0, r4
    
    and FL, ~UVE_FL_VIRUSFOUND, FL
    qsearchi r1, r0, r2, r3, r4
    setvariant "Variant-fortest-1.0.0"
    
CheckVirusFound:
    test FL, UVE_FL_VIRUSFOUND
    JZ Quit
    CheckRepairFlag(Clean)
Quit:
    exit
Clean:
    calli CleanScannedFile
    exit

PATTERN:
bdata ("Malware-fortest-1.0.0", 0)

VARIANT:
bdata ("Variant-fortest-1.0.0", 0)

WILDCARD:
bdata ("*?")
